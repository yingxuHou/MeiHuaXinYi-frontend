<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰‹æœºå·éªŒè¯å®Œæ•´æµ‹è¯• - æ¢…èŠ±å¿ƒæ˜“</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .section h3 {
            color: #fbbf24;
            margin-top: 0;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #fbbf24;
        }
        input {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
        }
        input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        input.valid {
            border-color: #10b981;
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2);
        }
        input.invalid {
            border-color: #ef4444;
            box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.2);
        }
        .btn {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #1e3a8a;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(251, 191, 36, 0.4);
        }
        .btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .btn.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }
        .status.success {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: #10b981;
        }
        .status.error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }
        .status.warning {
            background: rgba(245, 158, 11, 0.2);
            border: 1px solid rgba(245, 158, 11, 0.3);
            color: #f59e0b;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .test-case {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .test-case h4 {
            margin: 0 0 10px 0;
            color: #fbbf24;
        }
        .phone-display {
            font-family: monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 8px 12px;
            border-radius: 4px;
            margin: 8px 0;
            font-size: 16px;
        }
        .validation-result {
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
            font-size: 14px;
        }
        .validation-result.valid {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }
        .validation-result.invalid {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“± æ‰‹æœºå·éªŒè¯å®Œæ•´æµ‹è¯•</h1>
        
        <!-- ä¿®å¤çŠ¶æ€ -->
        <div class="section">
            <h3>âœ… ä¿®å¤çŠ¶æ€ç¡®è®¤</h3>
            <div class="status success">
                <strong>ğŸ‰ æ‰‹æœºå·éªŒè¯å·²ä¿®å¤ï¼</strong><br>
                âœ… æ”¯æŒæ‰€æœ‰1å¼€å¤´çš„11ä½å·ç ï¼ˆåŒ…æ‹¬12ã€11å¼€å¤´ï¼‰<br>
                âœ… è‡ªåŠ¨å¤„ç†æ ¼å¼åŒ–è¾“å…¥ï¼ˆç©ºæ ¼ã€æ¨ªçº¿ç­‰ï¼‰<br>
                âœ… æä¾›è¯¦ç»†çš„é”™è¯¯æç¤ºä¿¡æ¯<br>
                âœ… å‰åç«¯éªŒè¯è§„åˆ™å·²åŒæ­¥æ›´æ–°
            </div>
        </div>

        <!-- å®æ—¶éªŒè¯æµ‹è¯• -->
        <div class="section">
            <h3>ğŸ§ª å®æ—¶éªŒè¯æµ‹è¯•</h3>
            <div class="form-group">
                <label for="phoneTest">è¾“å…¥æ‰‹æœºå·è¿›è¡Œå®æ—¶éªŒè¯ï¼š</label>
                <input 
                    type="text" 
                    id="phoneTest" 
                    placeholder="è¯·è¾“å…¥æ‰‹æœºå·ï¼Œæ”¯æŒå¤šç§æ ¼å¼ï¼š138 0013 8000"
                    oninput="realTimeValidation()"
                    maxlength="20"
                >
            </div>
            
            <div class="test-grid">
                <div class="test-case">
                    <h4>ğŸ“± åŸå§‹è¾“å…¥</h4>
                    <div class="phone-display" id="originalPhone">-</div>
                </div>
                <div class="test-case">
                    <h4>ğŸ§¹ æ¸…ç†å</h4>
                    <div class="phone-display" id="cleanedPhone">-</div>
                </div>
                <div class="test-case">
                    <h4>ğŸ’« æ ¼å¼åŒ–æ˜¾ç¤º</h4>
                    <div class="phone-display" id="formattedPhone">-</div>
                </div>
                <div class="test-case">
                    <h4>âœ… éªŒè¯ç»“æœ</h4>
                    <div class="validation-result" id="validationResult">è¯·è¾“å…¥æ‰‹æœºå·</div>
                </div>
            </div>
        </div>

        <!-- å‰åç«¯APIæµ‹è¯• -->
        <div class="section">
            <h3>ğŸ”— å‰åç«¯APIæµ‹è¯•</h3>
            <div class="form-group">
                <label for="apiTestPhone">æµ‹è¯•æ‰‹æœºå·ï¼š</label>
                <input 
                    type="text" 
                    id="apiTestPhone" 
                    placeholder="è¾“å…¥è¦æµ‹è¯•çš„æ‰‹æœºå·"
                    value="138 0013 8000"
                >
            </div>
            
            <button class="btn success" onclick="testUserRegistration()">ğŸ” æµ‹è¯•ç”¨æˆ·æ³¨å†Œ</button>
            <button class="btn success" onclick="testProfileUpdate()">ğŸ‘¤ æµ‹è¯•èµ„æ–™æ›´æ–°</button>
            <button class="btn secondary" onclick="clearApiResults()">ğŸ—‘ï¸ æ¸…é™¤ç»“æœ</button>
            
            <div id="apiTestResults"></div>
        </div>

        <!-- æ ‡å‡†æµ‹è¯•ç”¨ä¾‹ -->
        <div class="section">
            <h3>ğŸ“‹ æ ‡å‡†æµ‹è¯•ç”¨ä¾‹éªŒè¯</h3>
            <button class="btn" onclick="runStandardTests()">ğŸš€ è¿è¡Œæ ‡å‡†æµ‹è¯•</button>
            <button class="btn secondary" onclick="clearTestResults()">ğŸ—‘ï¸ æ¸…é™¤ç»“æœ</button>
            
            <div class="test-grid" id="standardTests">
                <!-- æµ‹è¯•ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>

        <!-- ç”¨æˆ·ä½“éªŒæµ‹è¯• -->
        <div class="section">
            <h3>ğŸ¯ ç”¨æˆ·ä½“éªŒæµ‹è¯•</h3>
            <p>æµ‹è¯•å„ç§ç”¨æˆ·å¯èƒ½è¾“å…¥çš„æ‰‹æœºå·æ ¼å¼ï¼š</p>
            
            <div class="test-grid">
                <div class="test-case">
                    <h4>ğŸ“ å¿«é€Ÿæµ‹è¯•</h4>
                    <button class="btn secondary" onclick="quickTest('13800138000')">æ ‡å‡†æ ¼å¼</button>
                    <button class="btn secondary" onclick="quickTest('138 0013 8000')">å¸¦ç©ºæ ¼</button>
                    <button class="btn secondary" onclick="quickTest('138-0013-8000')">å¸¦æ¨ªçº¿</button>
                    <button class="btn secondary" onclick="quickTest('12012345678')">12å¼€å¤´</button>
                </div>
                <div class="test-case">
                    <h4>âŒ é”™è¯¯æ ¼å¼æµ‹è¯•</h4>
                    <button class="btn secondary" onclick="quickTest('1380013800')">10ä½æ•°å­—</button>
                    <button class="btn secondary" onclick="quickTest('138001380000')">12ä½æ•°å­—</button>
                    <button class="btn secondary" onclick="quickTest('238001380000')">é1å¼€å¤´</button>
                    <button class="btn secondary" onclick="quickTest('138abc38000')">åŒ…å«å­—æ¯</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ”¹è¿›çš„éªŒè¯å‡½æ•°ï¼ˆä¸ä¿®å¤åçš„ä»£ç ä¸€è‡´ï¼‰
        function validatePhone(phone) {
            if (!phone) return false
            
            // æ¸…ç†è¾“å…¥ï¼šç§»é™¤ç©ºæ ¼ã€æ¨ªçº¿ã€æ‹¬å·ç­‰åˆ†éš”ç¬¦
            const cleaned = phone.replace(/[\s\-\(\)\+]/g, '')
            
            // éªŒè¯ï¼š11ä½æ•°å­—ä¸”ä»¥1å¼€å¤´
            const phoneRegex = /^1[0-9]\d{9}$/
            return phoneRegex.test(cleaned)
        }

        function cleanPhoneInput(phone) {
            if (!phone) return ''
            return phone.replace(/[\s\-\(\)\+]/g, '')
        }

        function formatPhoneDisplay(phone) {
            const cleaned = cleanPhoneInput(phone)
            if (cleaned.length === 11) {
                return `${cleaned.slice(0, 3)} ${cleaned.slice(3, 7)} ${cleaned.slice(7)}`
            }
            return cleaned
        }

        function getPhoneValidationError(phone) {
            if (!phone) return 'è¯·è¾“å…¥æ‰‹æœºå·'
            
            const cleaned = cleanPhoneInput(phone)
            
            if (cleaned.length === 0) {
                return 'è¯·è¾“å…¥æ‰‹æœºå·'
            }
            
            if (!/^\d+$/.test(cleaned)) {
                return 'æ‰‹æœºå·åªèƒ½åŒ…å«æ•°å­—'
            }
            
            if (cleaned.length < 11) {
                return `æ‰‹æœºå·é•¿åº¦ä¸è¶³ï¼Œå½“å‰${cleaned.length}ä½ï¼Œéœ€è¦11ä½`
            }
            
            if (cleaned.length > 11) {
                return `æ‰‹æœºå·é•¿åº¦è¿‡é•¿ï¼Œå½“å‰${cleaned.length}ä½ï¼Œéœ€è¦11ä½`
            }
            
            if (!cleaned.startsWith('1')) {
                return 'æ‰‹æœºå·å¿…é¡»ä»¥1å¼€å¤´'
            }
            
            return '' // éªŒè¯é€šè¿‡
        }

        // å®æ—¶éªŒè¯
        function realTimeValidation() {
            const input = document.getElementById('phoneTest').value
            const cleaned = cleanPhoneInput(input)
            const formatted = formatPhoneDisplay(input)
            const isValid = validatePhone(input)
            const error = getPhoneValidationError(input)
            
            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('originalPhone').textContent = input || '-'
            document.getElementById('cleanedPhone').textContent = cleaned || '-'
            document.getElementById('formattedPhone').textContent = formatted || '-'
            
            // æ›´æ–°éªŒè¯ç»“æœ
            const resultDiv = document.getElementById('validationResult')
            if (isValid) {
                resultDiv.textContent = 'âœ… æ‰‹æœºå·æ ¼å¼æ­£ç¡®'
                resultDiv.className = 'validation-result valid'
            } else {
                resultDiv.textContent = error || 'âŒ æ‰‹æœºå·æ ¼å¼é”™è¯¯'
                resultDiv.className = 'validation-result invalid'
            }
            
            // æ›´æ–°è¾“å…¥æ¡†æ ·å¼
            const inputElement = document.getElementById('phoneTest')
            if (input) {
                inputElement.className = isValid ? 'valid' : 'invalid'
            } else {
                inputElement.className = ''
            }
        }

        // å¿«é€Ÿæµ‹è¯•
        function quickTest(phone) {
            document.getElementById('phoneTest').value = phone
            realTimeValidation()
        }

        // æµ‹è¯•ç”¨æˆ·æ³¨å†ŒAPI
        async function testUserRegistration() {
            const phone = document.getElementById('apiTestPhone').value
            const resultsDiv = document.getElementById('apiTestResults')
            
            resultsDiv.innerHTML = '<div class="status warning">ğŸ”„ æ­£åœ¨æµ‹è¯•ç”¨æˆ·æ³¨å†ŒAPI...</div>'
            
            try {
                const response = await fetch('http://localhost:3001/api/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: 'test_' + Date.now().toString().slice(-6),
                        email: `test_${Date.now()}@example.com`,
                        password: 'Test123456A',
                        phone: phone
                    })
                })
                
                const data = await response.json()
                
                if (response.ok && data.success) {
                    resultsDiv.innerHTML = `
                        <div class="status success">
                            <strong>âœ… æ³¨å†ŒAPIæµ‹è¯•æˆåŠŸï¼</strong><br>
                            æ‰‹æœºå· "${phone}" é€šè¿‡åç«¯éªŒè¯<br>
                            ç”¨æˆ·ID: ${data.data.user.id}
                        </div>
                    `
                } else {
                    resultsDiv.innerHTML = `
                        <div class="status error">
                            <strong>âŒ æ³¨å†ŒAPIæµ‹è¯•å¤±è´¥</strong><br>
                            é”™è¯¯ä¿¡æ¯: ${data.error?.message || 'æœªçŸ¥é”™è¯¯'}<br>
                            ${data.error?.details ? data.error.details.map(d => d.msg).join('<br>') : ''}
                        </div>
                    `
                }
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="status error">
                        <strong>âŒ ç½‘ç»œé”™è¯¯</strong><br>
                        ${error.message}<br>
                        è¯·ç¡®ä¿åç«¯æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
                    </div>
                `
            }
        }

        // æµ‹è¯•èµ„æ–™æ›´æ–°API
        async function testProfileUpdate() {
            const phone = document.getElementById('apiTestPhone').value
            const resultsDiv = document.getElementById('apiTestResults')
            
            resultsDiv.innerHTML = '<div class="status warning">ğŸ”„ æ­£åœ¨æµ‹è¯•èµ„æ–™æ›´æ–°API...</div>'
            
            // è¿™é‡Œéœ€è¦å…ˆæœ‰ç™»å½•tokenï¼Œç®€åŒ–æµ‹è¯•
            resultsDiv.innerHTML = `
                <div class="status warning">
                    <strong>âš ï¸ èµ„æ–™æ›´æ–°æµ‹è¯•éœ€è¦ç™»å½•</strong><br>
                    è¯·å…ˆé€šè¿‡ç”¨æˆ·ç®¡ç†æµ‹è¯•é¡µé¢ç™»å½•ï¼Œç„¶åæµ‹è¯•èµ„æ–™æ›´æ–°åŠŸèƒ½<br>
                    <a href="http://localhost:5173/user-management-test.html" target="_blank" style="color: #fbbf24;">æ‰“å¼€ç”¨æˆ·ç®¡ç†æµ‹è¯•</a>
                </div>
            `
        }

        // è¿è¡Œæ ‡å‡†æµ‹è¯•
        function runStandardTests() {
            const testCases = [
                { phone: '13800138000', description: 'æ ‡å‡†ç§»åŠ¨å·ç ', shouldPass: true },
                { phone: '15912345678', description: 'æ ‡å‡†è”é€šå·ç ', shouldPass: true },
                { phone: '18888888888', description: 'æ ‡å‡†ç”µä¿¡å·ç ', shouldPass: true },
                { phone: '12012345678', description: '12å¼€å¤´å·ç ï¼ˆä¿®å¤åæ”¯æŒï¼‰', shouldPass: true },
                { phone: '11012345678', description: '11å¼€å¤´å·ç ï¼ˆä¿®å¤åæ”¯æŒï¼‰', shouldPass: true },
                { phone: '138 0013 8000', description: 'å¸¦ç©ºæ ¼æ ¼å¼', shouldPass: true },
                { phone: '138-0013-8000', description: 'å¸¦æ¨ªçº¿æ ¼å¼', shouldPass: true },
                { phone: '(138)0013-8000', description: 'å¸¦æ‹¬å·æ ¼å¼', shouldPass: true },
                { phone: '12345678901', description: 'ä¸ä»¥1å¼€å¤´', shouldPass: false },
                { phone: '1380013800', description: 'åªæœ‰10ä½', shouldPass: false },
                { phone: '138001380000', description: '12ä½æ•°å­—', shouldPass: false },
                { phone: '138abc38000', description: 'åŒ…å«å­—æ¯', shouldPass: false }
            ]
            
            const container = document.getElementById('standardTests')
            container.innerHTML = ''
            
            testCases.forEach((testCase, index) => {
                const isValid = validatePhone(testCase.phone)
                const testPassed = isValid === testCase.shouldPass
                
                const div = document.createElement('div')
                div.className = 'test-case'
                
                const statusIcon = testPassed ? 'âœ…' : 'âŒ'
                const statusClass = testPassed ? 'success' : 'error'
                
                div.innerHTML = `
                    <h4>${statusIcon} æµ‹è¯• ${index + 1}: ${testCase.description}</h4>
                    <div class="phone-display">${testCase.phone}</div>
                    <p>æœŸæœ›: ${testCase.shouldPass ? 'âœ… æœ‰æ•ˆ' : 'âŒ æ— æ•ˆ'}</p>
                    <p>å®é™…: ${isValid ? 'âœ… æœ‰æ•ˆ' : 'âŒ æ— æ•ˆ'}</p>
                    <div class="validation-result ${testPassed ? 'valid' : 'invalid'}">
                        ${testPassed ? 'âœ… æµ‹è¯•é€šè¿‡' : 'âŒ æµ‹è¯•å¤±è´¥'}
                    </div>
                `
                
                container.appendChild(div)
            })
        }

        function clearApiResults() {
            document.getElementById('apiTestResults').innerHTML = ''
        }

        function clearTestResults() {
            document.getElementById('standardTests').innerHTML = ''
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', () => {
            // è®¾ç½®ç¤ºä¾‹æ‰‹æœºå·
            document.getElementById('phoneTest').value = '138 0013 8000'
            realTimeValidation()
            
            // è¿è¡Œæ ‡å‡†æµ‹è¯•
            setTimeout(() => {
                runStandardTests()
            }, 1000)
        })
    </script>
</body>
</html>
