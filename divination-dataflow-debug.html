<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å åœæ•°æ®æµè°ƒè¯• - çœŸå®APIæµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: white;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #fbbf24, #f59e0b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .debug-section {
            margin-bottom: 3rem;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .debug-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: #fbbf24;
        }

        .debug-button {
            background: linear-gradient(45deg, #fbbf24, #f59e0b);
            color: #1e3a8a;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 1rem;
            margin-bottom: 1rem;
        }

        .debug-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(251, 191, 36, 0.4);
        }

        .debug-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .data-display {
            margin-top: 2rem;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .data-title {
            font-size: 1.2rem;
            color: #fbbf24;
            margin-bottom: 1rem;
        }

        .hexagram-comparison {
            display: flex;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .hexagram-item {
            flex: 1;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .hexagram-name {
            font-size: 1rem;
            font-weight: 600;
            color: #fbbf24;
            margin-bottom: 0.5rem;
        }

        .hexagram-lines {
            font-family: monospace;
            font-size: 1.2rem;
            color: #ffffff;
            margin-bottom: 0.5rem;
        }

        .line-yang {
            color: #fbbf24;
        }

        .line-yin {
            color: #1e3a8a;
        }

        .moving-line {
            color: #ef4444;
            font-weight: bold;
        }

        .status {
            margin-top: 1rem;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: 600;
        }

        .status.success {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .status.error {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .status.warning {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .log-section {
            margin-top: 2rem;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-height: 300px;
            overflow-y: auto;
        }

        .log-entry {
            margin-bottom: 0.5rem;
            padding: 0.25rem 0;
            font-family: monospace;
            font-size: 0.9rem;
        }

        .log-success {
            color: #22c55e;
        }

        .log-warning {
            color: #fbbf24;
        }

        .log-error {
            color: #ef4444;
        }

        .log-info {
            color: #3b82f6;
        }

        .input-group {
            margin-bottom: 1rem;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #fbbf24;
            font-weight: 600;
        }

        .input-group input, .input-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 1rem;
        }

        .input-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .json-display {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            padding: 1rem;
            margin-top: 1rem;
            font-family: monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>å åœæ•°æ®æµè°ƒè¯• - çœŸå®APIæµ‹è¯•</h1>
            <p>æµ‹è¯•çœŸå®APIè°ƒç”¨ã€æ•°æ®é€‚é…å™¨ã€åŠ¨ç”»ç»„ä»¶çš„æ•°æ®ä¸€è‡´æ€§</p>
        </div>

        <div class="debug-section">
            <h2 class="debug-title">APIæµ‹è¯•é…ç½®</h2>
            <div class="input-group">
                <label for="apiUrl">APIåœ°å€:</label>
                <input type="text" id="apiUrl" value="http://localhost:3000/api/divination/perform" placeholder="APIåœ°å€">
            </div>
            <div class="input-group">
                <label for="question">å åœé—®é¢˜:</label>
                <textarea id="question" placeholder="è¯·è¾“å…¥å åœé—®é¢˜...">æˆ‘çš„äº‹ä¸šè¿åŠ¿å¦‚ä½•ï¼Ÿ</textarea>
            </div>
            <div class="input-group">
                <label for="token">JWT Token (å¯é€‰):</label>
                <input type="text" id="token" placeholder="Bearer token (å¯é€‰)">
            </div>
            
            <button class="debug-button" onclick="testRealAPI()">æµ‹è¯•çœŸå®API</button>
            <button class="debug-button" onclick="testDataAdapter()">æµ‹è¯•æ•°æ®é€‚é…å™¨</button>
            <button class="debug-button" onclick="testAnimationComponent()">æµ‹è¯•åŠ¨ç”»ç»„ä»¶</button>
            <button class="debug-button" onclick="clearAllData()">æ¸…é™¤æ‰€æœ‰æ•°æ®</button>
        </div>

        <div class="debug-section">
            <h2 class="debug-title">æ•°æ®æµåˆ†æ</h2>
            <div id="dataFlowAnalysis" class="data-display" style="display: none;">
                <div class="data-title">æ•°æ®æµå¯¹æ¯”</div>
                <div class="hexagram-comparison">
                    <div class="hexagram-item">
                        <div class="hexagram-name">1. åç«¯APIåŸå§‹æ•°æ®</div>
                        <div id="rawApiData" class="json-display"></div>
                    </div>
                    <div class="hexagram-item">
                        <div class="hexagram-name">2. æ•°æ®é€‚é…å™¨å¤„ç†å</div>
                        <div id="adaptedData" class="json-display"></div>
                    </div>
                    <div class="hexagram-item">
                        <div class="hexagram-name">3. åŠ¨ç”»ç»„ä»¶ä½¿ç”¨</div>
                        <div id="animationData" class="json-display"></div>
                    </div>
                </div>
                <div id="flowStatus" class="status warning"></div>
            </div>
        </div>

        <div class="debug-section">
            <h2 class="debug-title">å¦è±¡æ•°æ®å¯¹æ¯”</h2>
            <div id="hexagramComparison" class="data-display" style="display: none;">
                <div class="data-title">ä¸‰å¦æ•°æ®è¯¦ç»†å¯¹æ¯”</div>
                <div class="hexagram-comparison">
                    <div class="hexagram-item">
                        <div class="hexagram-name">ä¸»å¦ (ben)</div>
                        <div id="benComparison" class="hexagram-lines"></div>
                    </div>
                    <div class="hexagram-item">
                        <div class="hexagram-name">äº’å¦ (hu)</div>
                        <div id="huComparison" class="hexagram-lines"></div>
                    </div>
                    <div class="hexagram-item">
                        <div class="hexagram-name">å˜å¦ (bian)</div>
                        <div id="bianComparison" class="hexagram-lines"></div>
                    </div>
                </div>
                <div id="hexagramStatus" class="status warning"></div>
            </div>
        </div>

        <div class="debug-section">
            <h2 class="debug-title">è°ƒè¯•æ—¥å¿—</h2>
            <div id="debugLog" class="log-section">
                <div class="log-entry log-info">ç­‰å¾…è°ƒè¯•æ•°æ®...</div>
            </div>
        </div>
    </div>

    <script>
        let debugData = {
            rawApiData: null,
            adaptedData: null,
            animationData: null
        };

        function log(message, type = 'info') {
            const logSection = document.getElementById('debugLog');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logSection.appendChild(logEntry);
            logSection.scrollTop = logSection.scrollHeight;
        }

        async function testRealAPI() {
            const apiUrl = document.getElementById('apiUrl').value;
            const question = document.getElementById('question').value;
            const token = document.getElementById('token').value;

            if (!apiUrl || !question) {
                log('âŒ è¯·å¡«å†™APIåœ°å€å’Œå åœé—®é¢˜', 'error');
                return;
            }

            log('ğŸš€ å¼€å§‹æµ‹è¯•çœŸå®API...', 'info');

            try {
                const requestData = {
                    question: question,
                    method: 'time',
                    params: {
                        datetime: new Date().toISOString()
                    }
                };

                const headers = {
                    'Content-Type': 'application/json'
                };

                if (token) {
                    headers['Authorization'] = token.startsWith('Bearer ') ? token : `Bearer ${token}`;
                }

                log(`ğŸ“¡ å‘é€è¯·æ±‚åˆ°: ${apiUrl}`, 'info');
                log(`ğŸ“ è¯·æ±‚æ•°æ®: ${JSON.stringify(requestData, null, 2)}`, 'info');

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(requestData)
                });

                const responseData = await response.json();

                if (response.ok && responseData.success) {
                    debugData.rawApiData = responseData.data;
                    log('âœ… APIè°ƒç”¨æˆåŠŸ', 'success');
                    log(`ğŸ“Š è¿”å›æ•°æ®ID: ${responseData.data.id}`, 'success');
                    
                    // æ˜¾ç¤ºåŸå§‹æ•°æ®
                    document.getElementById('rawApiData').textContent = JSON.stringify(responseData.data, null, 2);
                    
                    // åˆ†ææ•°æ®ç»“æ„
                    analyzeApiData(responseData.data);
                } else {
                    log(`âŒ APIè°ƒç”¨å¤±è´¥: ${responseData.message || 'æœªçŸ¥é”™è¯¯'}`, 'error');
                    log(`ğŸ“Š å“åº”çŠ¶æ€: ${response.status}`, 'error');
                    log(`ğŸ“Š å“åº”æ•°æ®: ${JSON.stringify(responseData, null, 2)}`, 'error');
                }
            } catch (error) {
                log(`âŒ APIè°ƒç”¨å¼‚å¸¸: ${error.message}`, 'error');
                console.error('APIè°ƒç”¨é”™è¯¯:', error);
            }
        }

        function analyzeApiData(data) {
            log('ğŸ” åˆ†æAPIæ•°æ®ç»“æ„...', 'info');

            // æ£€æŸ¥å¿…è¦å­—æ®µ
            const checks = [
                { field: 'hexagrams', path: 'hexagrams', required: true },
                { field: 'hexagrams.ben', path: 'hexagrams.ben', required: true },
                { field: 'hexagrams.hu', path: 'hexagrams.hu', required: true },
                { field: 'hexagrams.bian', path: 'hexagrams.bian', required: true },
                { field: 'movingLine', path: 'movingLine', required: true }
            ];

            let allPresent = true;
            checks.forEach(check => {
                const value = getNestedValue(data, check.path);
                if (value !== undefined && value !== null) {
                    log(`âœ… ${check.field}: å­˜åœ¨`, 'success');
                    if (check.field.includes('hexagrams') && value.lines) {
                        log(`  â””â”€ lines: [${value.lines.join(', ')}]`, 'info');
                    }
                } else {
                    log(`âŒ ${check.field}: ç¼ºå¤±`, 'error');
                    allPresent = false;
                }
            });

            if (allPresent) {
                log('ğŸ‰ æ‰€æœ‰å¿…è¦å­—æ®µéƒ½å­˜åœ¨', 'success');
            } else {
                log('âš ï¸ éƒ¨åˆ†å­—æ®µç¼ºå¤±ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´', 'warning');
            }
        }

        function getNestedValue(obj, path) {
            return path.split('.').reduce((current, key) => current?.[key], obj);
        }

        function testDataAdapter() {
            if (!debugData.rawApiData) {
                log('âŒ è¯·å…ˆæµ‹è¯•çœŸå®API', 'error');
                return;
            }

            log('ğŸ”§ æµ‹è¯•æ•°æ®é€‚é…å™¨...', 'info');

            try {
                // æ¨¡æ‹Ÿæ•°æ®é€‚é…å™¨é€»è¾‘
                const adaptedData = adaptDivinationResult(debugData.rawApiData);
                debugData.adaptedData = adaptedData;

                log('âœ… æ•°æ®é€‚é…å™¨å¤„ç†å®Œæˆ', 'success');
                
                // æ˜¾ç¤ºé€‚é…åçš„æ•°æ®
                document.getElementById('adaptedData').textContent = JSON.stringify(adaptedData, null, 2);
                
                // åˆ†æé€‚é…ç»“æœ
                analyzeAdaptedData(adaptedData);
            } catch (error) {
                log(`âŒ æ•°æ®é€‚é…å™¨é”™è¯¯: ${error.message}`, 'error');
                console.error('æ•°æ®é€‚é…å™¨é”™è¯¯:', error);
            }
        }

        function adaptDivinationResult(apiData) {
            if (!apiData) return null;

            const {
                id,
                question,
                timestamp,
                createdAt,
                hexagrams = {},
                movingLine,
                analysis = {},
                interpretation = {},
                userRating,
                metadata = {}
            } = apiData;

            // ç¡®ä¿å¿…è¦å­—æ®µå­˜åœ¨ - è¿™é‡Œæ˜¯é—®é¢˜æ‰€åœ¨ï¼
            const safeHexagrams = {
                ben: hexagrams.ben || { id: 1, name: 'ä¹¾ä¸ºå¤©', lines: [1,1,1,1,1,1], upperGua: { name: 'ä¹¾' }, lowerGua: { name: 'ä¹¾' } },
                hu: hexagrams.hu || { id: 1, name: 'ä¹¾ä¸ºå¤©', lines: [1,1,1,1,1,1], upperGua: { name: 'ä¹¾' }, lowerGua: { name: 'ä¹¾' } },
                bian: hexagrams.bian || { id: 2, name: 'å¤ä¸ºåœ°', lines: [0,0,0,0,0,0], upperGua: { name: 'å¤' }, lowerGua: { name: 'å¤' } }
            };

            return {
                id: id || 'temp_' + Date.now(),
                question: question || 'æœªçŸ¥é—®é¢˜',
                timestamp: timestamp || createdAt || new Date(),
                
                // ä¸‰å¦ä¿¡æ¯
                hexagrams: {
                    ben: safeHexagrams.ben,
                    hu: safeHexagrams.hu,
                    bian: safeHexagrams.bian
                },

                // åŠ¨çˆ»ä¿¡æ¯
                movingLine: movingLine || 1,

                // è§£è¯»ä¿¡æ¯
                interpretation: {
                    summary: interpretation.summary || 'ä¸“ä¸šè§£è¯»æ­£åœ¨ç”Ÿæˆä¸­...',
                    detailed: interpretation.detailed || 'è¯¦ç»†è§£è¯»æ­£åœ¨ç”Ÿæˆä¸­...',
                    advice: interpretation.advice || 'è¯·è€å¿ƒç­‰å¾…ä¸“ä¸šå»ºè®®...',
                    precautions: interpretation.precautions || 'æš‚æ— ç‰¹åˆ«æ³¨æ„äº‹é¡¹'
                }
            };
        }

        function analyzeAdaptedData(data) {
            log('ğŸ” åˆ†æé€‚é…åçš„æ•°æ®...', 'info');

            // æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†é»˜è®¤å€¼
            const defaultBen = [1,1,1,1,1,1];
            const defaultHu = [1,1,1,1,1,1];
            const defaultBian = [0,0,0,0,0,0];

            if (JSON.stringify(data.hexagrams.ben.lines) === JSON.stringify(defaultBen)) {
                log('âš ï¸ ä¸»å¦ä½¿ç”¨äº†é»˜è®¤å€¼ï¼', 'warning');
            } else {
                log('âœ… ä¸»å¦ä½¿ç”¨çœŸå®æ•°æ®', 'success');
            }

            if (JSON.stringify(data.hexagrams.hu.lines) === JSON.stringify(defaultHu)) {
                log('âš ï¸ äº’å¦ä½¿ç”¨äº†é»˜è®¤å€¼ï¼', 'warning');
            } else {
                log('âœ… äº’å¦ä½¿ç”¨çœŸå®æ•°æ®', 'success');
            }

            if (JSON.stringify(data.hexagrams.bian.lines) === JSON.stringify(defaultBian)) {
                log('âš ï¸ å˜å¦ä½¿ç”¨äº†é»˜è®¤å€¼ï¼', 'warning');
            } else {
                log('âœ… å˜å¦ä½¿ç”¨çœŸå®æ•°æ®', 'success');
            }
        }

        function testAnimationComponent() {
            if (!debugData.adaptedData) {
                log('âŒ è¯·å…ˆæµ‹è¯•æ•°æ®é€‚é…å™¨', 'error');
                return;
            }

            log('ğŸ¬ æµ‹è¯•åŠ¨ç”»ç»„ä»¶æ•°æ®å¤„ç†...', 'info');

            try {
                // æ¨¡æ‹ŸåŠ¨ç”»ç»„ä»¶é€»è¾‘
                const animationData = processAnimationData(debugData.adaptedData);
                debugData.animationData = animationData;

                log('âœ… åŠ¨ç”»ç»„ä»¶å¤„ç†å®Œæˆ', 'success');
                
                // æ˜¾ç¤ºåŠ¨ç”»æ•°æ®
                document.getElementById('animationData').textContent = JSON.stringify(animationData, null, 2);
                
                // è¿›è¡Œæœ€ç»ˆå¯¹æ¯”
                performFinalComparison();
            } catch (error) {
                log(`âŒ åŠ¨ç”»ç»„ä»¶é”™è¯¯: ${error.message}`, 'error');
                console.error('åŠ¨ç”»ç»„ä»¶é”™è¯¯:', error);
            }
        }

        function processAnimationData(adaptedData) {
            // æ¨¡æ‹ŸåŠ¨ç”»ç»„ä»¶çš„æ•°æ®å¤„ç†é€»è¾‘
            return {
                primaryHexagram: adaptedData.hexagrams.ben.lines,
                mutualHexagram: adaptedData.hexagrams.hu.lines,
                changeHexagram: adaptedData.hexagrams.bian.lines,
                movingLine: adaptedData.movingLine,
                source: 'adapted_data'
            };
        }

        function performFinalComparison() {
            log('ğŸ” è¿›è¡Œæœ€ç»ˆæ•°æ®ä¸€è‡´æ€§å¯¹æ¯”...', 'info');

            if (!debugData.rawApiData || !debugData.adaptedData || !debugData.animationData) {
                log('âŒ ç¼ºå°‘å¿…è¦æ•°æ®ï¼Œæ— æ³•è¿›è¡Œå¯¹æ¯”', 'error');
                return;
            }

            // æ˜¾ç¤ºæ•°æ®æµåˆ†æ
            document.getElementById('dataFlowAnalysis').style.display = 'block';
            document.getElementById('hexagramComparison').style.display = 'block';

            // å¯¹æ¯”å¦è±¡æ•°æ®
            const rawBen = debugData.rawApiData.hexagrams?.ben?.lines;
            const adaptedBen = debugData.adaptedData.hexagrams?.ben?.lines;
            const animationBen = debugData.animationData.primaryHexagram;

            const rawHu = debugData.rawApiData.hexagrams?.hu?.lines;
            const adaptedHu = debugData.adaptedData.hexagrams?.hu?.lines;
            const animationHu = debugData.animationData.mutualHexagram;

            const rawBian = debugData.rawApiData.hexagrams?.bian?.lines;
            const adaptedBian = debugData.adaptedData.hexagrams?.bian?.lines;
            const animationBian = debugData.animationData.changeHexagram;

            // æ˜¾ç¤ºå¯¹æ¯”ç»“æœ
            document.getElementById('benComparison').innerHTML = `
                <div>API: ${formatHexagram(rawBen)}</div>
                <div>é€‚é…: ${formatHexagram(adaptedBen)}</div>
                <div>åŠ¨ç”»: ${formatHexagram(animationBen)}</div>
            `;

            document.getElementById('huComparison').innerHTML = `
                <div>API: ${formatHexagram(rawHu)}</div>
                <div>é€‚é…: ${formatHexagram(adaptedHu)}</div>
                <div>åŠ¨ç”»: ${formatHexagram(animationHu)}</div>
            `;

            document.getElementById('bianComparison').innerHTML = `
                <div>API: ${formatHexagram(rawBian)}</div>
                <div>é€‚é…: ${formatHexagram(adaptedBian)}</div>
                <div>åŠ¨ç”»: ${formatHexagram(animationBian)}</div>
            `;

            // æ£€æŸ¥ä¸€è‡´æ€§
            let isConsistent = true;
            let issues = [];

            if (!arraysEqual(rawBen, adaptedBen)) {
                isConsistent = false;
                issues.push('ä¸»å¦ï¼šAPIä¸é€‚é…å™¨ä¸ä¸€è‡´');
            }

            if (!arraysEqual(rawHu, adaptedHu)) {
                isConsistent = false;
                issues.push('äº’å¦ï¼šAPIä¸é€‚é…å™¨ä¸ä¸€è‡´');
            }

            if (!arraysEqual(rawBian, adaptedBian)) {
                isConsistent = false;
                issues.push('å˜å¦ï¼šAPIä¸é€‚é…å™¨ä¸ä¸€è‡´');
            }

            if (!arraysEqual(adaptedBen, animationBen)) {
                isConsistent = false;
                issues.push('ä¸»å¦ï¼šé€‚é…å™¨ä¸åŠ¨ç”»ä¸ä¸€è‡´');
            }

            // æ˜¾ç¤ºçŠ¶æ€
            const statusDiv = document.getElementById('flowStatus');
            const hexagramStatusDiv = document.getElementById('hexagramStatus');

            if (isConsistent) {
                statusDiv.textContent = 'âœ… æ•°æ®æµå®Œå…¨ä¸€è‡´ï¼';
                statusDiv.className = 'status success';
                hexagramStatusDiv.textContent = 'âœ… æ‰€æœ‰å¦è±¡æ•°æ®ä¸€è‡´ï¼';
                hexagramStatusDiv.className = 'status success';
                log('ğŸ‰ æ•°æ®ä¸€è‡´æ€§æµ‹è¯•é€šè¿‡ï¼', 'success');
            } else {
                statusDiv.textContent = `âŒ å‘ç° ${issues.length} ä¸ªä¸ä¸€è‡´é—®é¢˜`;
                statusDiv.className = 'status error';
                hexagramStatusDiv.textContent = `âŒ å‘ç° ${issues.length} ä¸ªå¦è±¡ä¸ä¸€è‡´é—®é¢˜`;
                hexagramStatusDiv.className = 'status error';
                log(`âŒ æ•°æ®ä¸€è‡´æ€§æµ‹è¯•å¤±è´¥ï¼Œå‘ç° ${issues.length} ä¸ªé—®é¢˜`, 'error');
                issues.forEach(issue => log(`  - ${issue}`, 'error'));
            }
        }

        function formatHexagram(lines) {
            if (!lines || !Array.isArray(lines)) return 'æ— æ•°æ®';
            return lines.map(line => line === 1 ? 'âšŠ' : 'âš‹').join('');
        }

        function arraysEqual(a, b) {
            if (!a || !b) return false;
            if (a.length !== b.length) return false;
            for (let i = 0; i < a.length; i++) {
                if (a[i] !== b[i]) return false;
            }
            return true;
        }

        function clearAllData() {
            debugData = {
                rawApiData: null,
                adaptedData: null,
                animationData: null
            };
            
            document.getElementById('dataFlowAnalysis').style.display = 'none';
            document.getElementById('hexagramComparison').style.display = 'none';
            document.getElementById('debugLog').innerHTML = '<div class="log-entry log-info">è°ƒè¯•æ•°æ®å·²æ¸…é™¤</div>';
            
            log('è°ƒè¯•æ•°æ®å·²æ¸…é™¤', 'info');
        }

        // é¡µé¢åŠ è½½æ—¶çš„æç¤º
        window.addEventListener('load', function() {
            log('å åœæ•°æ®æµè°ƒè¯•å·¥å…·å·²åŠ è½½', 'info');
            log('è¯·æŒ‰é¡ºåºæµ‹è¯•ï¼š1. çœŸå®API â†’ 2. æ•°æ®é€‚é…å™¨ â†’ 3. åŠ¨ç”»ç»„ä»¶', 'info');
        });
    </script>
</body>
</html>
