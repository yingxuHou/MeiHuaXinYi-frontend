<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>占卜动画测试 - 梅花心易</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: white;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #fbbf24, #f59e0b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .demo-section {
            margin-bottom: 4rem;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .demo-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: #fbbf24;
        }

        .demo-description {
            margin-bottom: 2rem;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
        }

        .demo-button {
            background: linear-gradient(45deg, #fbbf24, #f59e0b);
            color: #1e3a8a;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 1rem;
            margin-bottom: 1rem;
        }

        .demo-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(251, 191, 36, 0.4);
        }

        .demo-button:active {
            transform: translateY(0);
        }

        /* 占卜动画样式 */
        .divination-animation-container {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
        }

        .animation-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .stars, .stars2, .stars3 {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(2px 2px at 20px 30px, #eee, transparent),
                radial-gradient(2px 2px at 40px 70px, rgba(255,255,255,0.8), transparent),
                radial-gradient(1px 1px at 90px 40px, #fff, transparent),
                radial-gradient(1px 1px at 130px 80px, rgba(255,255,255,0.6), transparent),
                radial-gradient(2px 2px at 160px 30px, #fff, transparent);
            background-repeat: repeat;
            background-size: 200px 100px;
            animation: sparkle 3s linear infinite;
        }

        .stars2 {
            animation-delay: 1s;
            background-size: 150px 75px;
        }

        .stars3 {
            animation-delay: 2s;
            background-size: 100px 50px;
        }

        @keyframes sparkle {
            from { transform: translateY(0px); }
            to { transform: translateY(-100px); }
        }

        .animation-content {
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 2rem;
        }

        .animation-title {
            text-align: center;
            margin-bottom: 3rem;
        }

        .title-text {
            font-size: 2.5rem;
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        .subtitle-text {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.7);
            margin: 0;
        }

        .coin-tossing-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .coin-container {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .coin {
            position: relative;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(145deg, #fbbf24, #f59e0b);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            transform-style: preserve-3d;
        }

        .coin.tossing {
            animation: coin-flip 1.5s ease-in-out;
        }

        .coin.landed {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.8);
        }

        .coin.yang {
            background: linear-gradient(145deg, #fbbf24, #f59e0b);
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.8);
        }

        .coin.yin {
            background: linear-gradient(145deg, #1e3a8a, #1e40af);
            box-shadow: 0 0 20px rgba(30, 58, 138, 0.8);
        }

        @keyframes coin-flip {
            0% { transform: rotateY(0deg) scale(1); }
            25% { transform: rotateY(90deg) scale(1.1); }
            50% { transform: rotateY(180deg) scale(1.2); }
            75% { transform: rotateY(270deg) scale(1.1); }
            100% { transform: rotateY(360deg) scale(1); }
        }

        .coin-face {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            backface-visibility: hidden;
        }

        .yang-face {
            background: linear-gradient(145deg, #fbbf24, #f59e0b);
            color: #1e3a8a;
        }

        .yin-face {
            background: linear-gradient(145deg, #1e3a8a, #1e40af);
            color: #fbbf24;
            transform: rotateY(180deg);
        }

        .yang-symbol, .yin-symbol {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.2rem;
        }

        .yang-text, .yin-text {
            font-size: 0.7rem;
            font-weight: 600;
        }

        .tossing-hint {
            text-align: center;
        }

        .hint-text {
            font-size: 1.2rem;
            color: #ffffff;
            margin-bottom: 1rem;
            font-weight: 500;
        }

        .progress-dots {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .progress-dot.active {
            background: #fbbf24;
            box-shadow: 0 0 10px rgba(251, 191, 36, 0.8);
        }

        .progress-dot.current {
            background: #6366f1;
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.8);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .hexagram-generation {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
            width: 100%;
            max-width: 800px;
        }

        .generation-title {
            text-align: center;
        }

        .generation-title h3 {
            font-size: 1.8rem;
            color: #ffffff;
            margin-bottom: 0.5rem;
        }

        .generation-title p {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.7);
            margin: 0;
        }

        .hexagrams-container {
            display: flex;
            gap: 2rem;
            justify-content: center;
            align-items: flex-start;
            width: 100%;
            flex-wrap: wrap;
        }

        .hexagram-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            flex: 1;
            min-width: 200px;
            max-width: 300px;
        }

        .hexagram-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #fbbf24;
            margin-bottom: 0.5rem;
        }

        .hexagram-lines {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            align-items: center;
        }

        .hexagram-line {
            position: relative;
            width: 80px;
            height: 8px;
            border-radius: 4px;
            transition: all 0.5s ease;
            opacity: 0;
            transform: translateX(-20px);
        }

        .hexagram-line.animated {
            animation: line-appear 0.8s ease-out forwards;
        }

        .hexagram-line.yang {
            background: linear-gradient(90deg, #fbbf24, #f59e0b);
            box-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
        }

        .hexagram-line.yin {
            background: linear-gradient(90deg, 
                #1e3a8a 0%, #1e3a8a 45%,
                transparent 45%, transparent 55%,
                #1e3a8a 55%, #1e3a8a 100%);
            box-shadow: 0 0 10px rgba(30, 58, 138, 0.5);
        }

        .hexagram-line.changing {
            background: linear-gradient(90deg, #ef4444, #dc2626);
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.8);
            animation: changing-glow 2s ease-in-out infinite alternate;
        }

        @keyframes line-appear {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes changing-glow {
            0% { box-shadow: 0 0 10px rgba(239, 68, 68, 0.5); }
            100% { box-shadow: 0 0 20px rgba(239, 68, 68, 1); }
        }

        .line-number {
            position: absolute;
            right: -25px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 500;
        }

        .completion-hint {
            text-align: center;
            margin-top: 2rem;
        }

        .completion-icon {
            font-size: 3rem;
            color: #22c55e;
            margin-bottom: 1rem;
            animation: success-pulse 2s ease-in-out infinite;
        }

        .completion-text {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 0.5rem;
        }

        .completion-subtitle {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.7);
        }

        @keyframes success-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .hidden {
            display: none;
        }

        .back-button {
            position: absolute;
            top: 2rem;
            left: 2rem;
            z-index: 10;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .title-text {
                font-size: 2rem;
            }
            
            .subtitle-text {
                font-size: 1rem;
            }
            
            .coin {
                width: 50px;
                height: 50px;
            }
            
            .coin-container {
                gap: 0.5rem;
            }
            
            .hexagrams-container {
                flex-direction: column;
                gap: 1rem;
            }

            .hexagram-display {
                min-width: auto;
                max-width: none;
                width: 100%;
            }
            
            .hexagram-line {
                width: 60px;
                height: 6px;
            }
            
            .line-number {
                right: -20px;
                font-size: 0.7rem;
            }
        }

        @media (max-width: 1024px) and (min-width: 769px) {
            .hexagrams-container {
                gap: 1.5rem;
            }

            .hexagram-display {
                min-width: 180px;
                max-width: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>梅花心易占卜动画</h1>
            <p>体验完整的占卜流程，从掷钱币到卦象生成</p>
        </div>

        <div class="demo-section">
            <h2 class="demo-title">占卜动画演示</h2>
            <p class="demo-description">
                这个演示展示了完整的占卜动画流程：<br>
                1. 六次掷钱币动画，每次显示阴阳结果<br>
                2. 根据掷币结果生成主卦<br>
                3. 计算并显示互卦<br>
                4. 计算并显示变卦（动爻会高亮显示）<br>
                5. 完成占卜流程
            </p>
            <button class="demo-button" onclick="startDivinationDemo()">开始占卜演示</button>
            <button class="demo-button" onclick="resetDemo()">重置演示</button>
        </div>

        <div class="demo-section">
            <h2 class="demo-title">技术特性</h2>
            <p class="demo-description">
                • 真实的掷钱币动画效果<br>
                • 实时的阴阳结果显示<br>
                • 卦象线条的渐进式动画<br>
                • 动爻的高亮显示效果<br>
                • 响应式设计，支持移动端<br>
                • 星空背景和神秘氛围
            </p>
        </div>
    </div>

    <!-- 占卜动画容器 -->
    <div id="divinationAnimation" class="divination-animation-container hidden">
        <button class="back-button" onclick="hideDivinationAnimation()">返回</button>
        
        <div class="animation-background">
            <div class="stars"></div>
            <div class="stars2"></div>
            <div class="stars3"></div>
        </div>

        <div class="animation-content">
            <div class="animation-title">
                <h2 class="title-text">正在为您占卜</h2>
                <p class="subtitle-text">诚心发问，智慧自现</p>
            </div>

            <div class="coin-tossing-area">
                <div class="coin-container" id="coinContainer">
                    <!-- 钱币将通过JavaScript动态生成 -->
                </div>

                <div class="tossing-hint">
                    <div class="hint-text" id="hintText">准备掷钱币...</div>
                    <div class="progress-dots" id="progressDots">
                        <!-- 进度点将通过JavaScript动态生成 -->
                    </div>
                </div>
            </div>

            <div class="hexagram-generation hidden" id="hexagramGeneration">
                <div class="generation-title">
                    <h3>卦象生成中</h3>
                    <p id="generationStep">生成主卦...</p>
                </div>

                <div class="hexagrams-container">
                    <div class="hexagram-display hidden" id="primaryHexagram">
                        <div class="hexagram-title">主卦</div>
                        <div class="hexagram-lines" id="primaryHexagramLines">
                            <!-- 主卦线条将通过JavaScript动态生成 -->
                        </div>
                    </div>

                    <div class="hexagram-display hidden" id="mutualHexagram">
                        <div class="hexagram-title">互卦</div>
                        <div class="hexagram-lines" id="mutualHexagramLines">
                            <!-- 互卦线条将通过JavaScript动态生成 -->
                        </div>
                    </div>

                    <div class="hexagram-display hidden" id="changeHexagram">
                        <div class="hexagram-title">变卦</div>
                        <div class="hexagram-lines" id="changeHexagramLines">
                            <!-- 变卦线条将通过JavaScript动态生成 -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="completion-hint hidden" id="completionHint">
                <div class="completion-icon">
                    ✓
                </div>
                <div class="completion-text">占卜完成</div>
                <div class="completion-subtitle">正在为您解读卦象...</div>
            </div>
        </div>
    </div>

    <script>
        // 占卜动画状态
        let coins = [];
        let currentCoinIndex = 0;
        let primaryHexagram = [];
        let mutualHexagram = [];
        let changeHexagram = [];
        let movingLineIndex = 0;

        // 初始化钱币
        function initializeCoins() {
            const coinContainer = document.getElementById('coinContainer');
            const progressDots = document.getElementById('progressDots');
            
            coinContainer.innerHTML = '';
            progressDots.innerHTML = '';
            
            coins = [];
            
            for (let i = 0; i < 6; i++) {
                // 创建钱币元素
                const coinElement = document.createElement('div');
                coinElement.className = 'coin';
                coinElement.style.animationDelay = `${i * 0.5}s`;
                
                coinElement.innerHTML = `
                    <div class="coin-face yang-face">
                        <div class="yang-symbol">⚊</div>
                        <div class="yang-text">阳</div>
                    </div>
                    <div class="coin-face yin-face">
                        <div class="yin-symbol">⚋</div>
                        <div class="yin-text">阴</div>
                    </div>
                `;
                
                coinContainer.appendChild(coinElement);
                
                // 创建进度点
                const progressDot = document.createElement('div');
                progressDot.className = 'progress-dot';
                progressDots.appendChild(progressDot);
                
                // 初始化钱币状态
                coins.push({
                    element: coinElement,
                    progressDot: progressDot,
                    isTossing: false,
                    hasLanded: false,
                    result: null
                });
            }
        }

        // 掷钱币动画
        function tossCoin(coinIndex) {
            const coin = coins[coinIndex];
            coin.element.classList.add('tossing');
            coin.element.classList.remove('landed');
            
            // 随机生成结果（0或1）
            setTimeout(() => {
                coin.result = Math.floor(Math.random() * 2);
                coin.element.classList.remove('tossing');
                coin.element.classList.add('landed');
                
                if (coin.result === 1) {
                    coin.element.classList.add('yang');
                    coin.element.classList.remove('yin');
                } else {
                    coin.element.classList.add('yin');
                    coin.element.classList.remove('yang');
                }
                
                // 更新进度点
                coin.progressDot.classList.add('active');
                coin.progressDot.classList.remove('current');
                
                // 更新提示文本
                const resultText = coin.result === 1 ? '阳' : '阴';
                document.getElementById('hintText').textContent = `第${coinIndex + 1}次掷币结果：${resultText}`;
                
            }, 1500); // 掷币动画持续1.5秒
        }

        // 生成卦象
        function generateHexagrams() {
            // 从掷币结果生成主卦
            primaryHexagram = coins.map(coin => coin.result);
            
            // 计算动爻（简化算法）
            movingLineIndex = Math.floor(Math.random() * 6) + 1;
            
            // 生成变卦
            changeHexagram = [...primaryHexagram];
            changeHexagram[movingLineIndex - 1] = changeHexagram[movingLineIndex - 1] === 1 ? 0 : 1;
            
            // 生成互卦（根据梅花易数规则）
            mutualHexagram = [
                primaryHexagram[1], // 第2爻
                primaryHexagram[2], // 第3爻
                primaryHexagram[3], // 第4爻
                primaryHexagram[2], // 第3爻
                primaryHexagram[3], // 第4爻
                primaryHexagram[4]  // 第5爻
            ];
        }

        // 显示卦象线条
        function displayHexagramLines(containerId, hexagram, isChanging = false) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            hexagram.forEach((line, index) => {
                const lineElement = document.createElement('div');
                lineElement.className = 'hexagram-line';
                lineElement.style.animationDelay = `${index * 0.2}s`;
                
                if (line === 1) {
                    lineElement.classList.add('yang');
                } else {
                    lineElement.classList.add('yin');
                }
                
                if (isChanging && index === movingLineIndex - 1) {
                    lineElement.classList.add('changing');
                }
                
                lineElement.innerHTML = `<div class="line-number">${index + 1}</div>`;
                container.appendChild(lineElement);
                
                // 添加动画类
                setTimeout(() => {
                    lineElement.classList.add('animated');
                }, 100);
            });
        }

        // 开始占卜动画
        function startDivinationDemo() {
            document.getElementById('divinationAnimation').classList.remove('hidden');
            initializeCoins();
            currentCoinIndex = 0;
            
            // 开始掷钱币
            const startTossing = () => {
                if (currentCoinIndex < 6) {
                    // 设置当前进度点
                    if (currentCoinIndex > 0) {
                        coins[currentCoinIndex - 1].progressDot.classList.remove('current');
                    }
                    coins[currentCoinIndex].progressDot.classList.add('current');
                    
                    tossCoin(currentCoinIndex);
                    currentCoinIndex++;
                    
                    // 设置下一个掷币的延迟
                    setTimeout(startTossing, 2000);
                } else {
                    // 所有掷币完成，开始生成卦象
                    setTimeout(() => {
                        document.getElementById('hexagramGeneration').classList.remove('hidden');
                        generateHexagrams();
                        showHexagramSequence();
                    }, 1000);
                }
            };
            
            startTossing();
        }

        // 显示卦象序列
        function showHexagramSequence() {
            // 显示主卦
            setTimeout(() => {
                document.getElementById('generationStep').textContent = '生成主卦...';
                document.getElementById('primaryHexagram').classList.remove('hidden');
                displayHexagramLines('primaryHexagramLines', primaryHexagram);
            }, 500);
            
            // 显示互卦
            setTimeout(() => {
                document.getElementById('generationStep').textContent = '生成互卦...';
                document.getElementById('mutualHexagram').classList.remove('hidden');
                displayHexagramLines('mutualHexagramLines', mutualHexagram);
            }, 2000);
            
            // 显示变卦
            setTimeout(() => {
                document.getElementById('generationStep').textContent = '生成变卦...';
                document.getElementById('changeHexagram').classList.remove('hidden');
                displayHexagramLines('changeHexagramLines', changeHexagram, true);
            }, 3500);
            
            // 完成动画
            setTimeout(() => {
                document.getElementById('generationStep').textContent = '卦象生成完成';
                document.getElementById('completionHint').classList.remove('hidden');
            }, 5000);
        }

        // 隐藏占卜动画
        function hideDivinationAnimation() {
            document.getElementById('divinationAnimation').classList.add('hidden');
        }

        // 重置演示
        function resetDemo() {
            hideDivinationAnimation();
            // 重置所有状态
            coins = [];
            currentCoinIndex = 0;
            primaryHexagram = [];
            mutualHexagram = [];
            changeHexagram = [];
            movingLineIndex = 0;
        }

        // 页面加载完成后的初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('占卜动画演示页面加载完成');
        });
    </script>
</body>
</html>
