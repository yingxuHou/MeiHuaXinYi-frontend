<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å åœæ•°æ®ä¸€è‡´æ€§è°ƒè¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: white;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #fbbf24, #f59e0b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .debug-section {
            margin-bottom: 3rem;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .debug-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: #fbbf24;
        }

        .debug-button {
            background: linear-gradient(45deg, #fbbf24, #f59e0b);
            color: #1e3a8a;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 1rem;
            margin-bottom: 1rem;
        }

        .debug-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(251, 191, 36, 0.4);
        }

        .data-display {
            margin-top: 2rem;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .data-title {
            font-size: 1.2rem;
            color: #fbbf24;
            margin-bottom: 1rem;
        }

        .hexagram-comparison {
            display: flex;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .hexagram-item {
            flex: 1;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .hexagram-name {
            font-size: 1rem;
            font-weight: 600;
            color: #fbbf24;
            margin-bottom: 0.5rem;
        }

        .hexagram-lines {
            font-family: monospace;
            font-size: 1.2rem;
            color: #ffffff;
            margin-bottom: 0.5rem;
        }

        .line-yang {
            color: #fbbf24;
        }

        .line-yin {
            color: #1e3a8a;
        }

        .moving-line {
            color: #ef4444;
            font-weight: bold;
        }

        .status {
            margin-top: 1rem;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: 600;
        }

        .status.success {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .status.error {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .status.warning {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .log-section {
            margin-top: 2rem;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-height: 300px;
            overflow-y: auto;
        }

        .log-entry {
            margin-bottom: 0.5rem;
            padding: 0.25rem 0;
            font-family: monospace;
            font-size: 0.9rem;
        }

        .log-success {
            color: #22c55e;
        }

        .log-warning {
            color: #fbbf24;
        }

        .log-error {
            color: #ef4444;
        }

        .log-info {
            color: #3b82f6;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>å åœæ•°æ®ä¸€è‡´æ€§è°ƒè¯•</h1>
            <p>è°ƒè¯•å åœåŠ¨ç”»ã€åç«¯æ•°æ®ã€å‰ç«¯å±•ç¤ºçš„ä¸€è‡´æ€§</p>
        </div>

        <div class="debug-section">
            <h2 class="debug-title">é—®é¢˜åˆ†æ</h2>
            <div style="color: rgba(255, 255, 255, 0.8); line-height: 1.6; margin-bottom: 2rem;">
                <p><strong>å‘ç°çš„é—®é¢˜ï¼š</strong></p>
                <ul style="margin-left: 2rem; margin-top: 0.5rem;">
                    <li>æ·å¸åŠ¨ç”»æ˜¾ç¤ºéšæœºç»“æœï¼Œä¸çœŸå®å åœç»“æœä¸ä¸€è‡´</li>
                    <li>åŠ¨ç”»ä¸­çš„å¦è±¡ä¸æœ€ç»ˆç»“æœé¡µé¢æ˜¾ç¤ºä¸åŒ</li>
                    <li>åç«¯å­˜å‚¨çš„æ•°æ®ä¸å‰ç«¯å±•ç¤ºçš„æ•°æ®ä¸åŒ¹é…</li>
                </ul>
                
                <p style="margin-top: 1rem;"><strong>æ ¹æœ¬åŸå› ï¼š</strong></p>
                <ul style="margin-left: 2rem; margin-top: 0.5rem;">
                    <li>åŠ¨ç”»ç»„ä»¶ä½¿ç”¨éšæœºç”Ÿæˆçš„æ•°æ®ï¼Œè€Œä¸æ˜¯çœŸå®çš„å åœç»“æœ</li>
                    <li>æ•°æ®æµä¸ç»Ÿä¸€ï¼šAPI â†’ åŠ¨ç”» â†’ ç»“æœé¡µé¢ ä¸‰ä¸ªç¯èŠ‚æ•°æ®ä¸ä¸€è‡´</li>
                    <li>ç¼ºå°‘æ•°æ®éªŒè¯å’ŒåŒæ­¥æœºåˆ¶</li>
                </ul>
            </div>
            
            <button class="debug-button" onclick="simulateDivination()">æ¨¡æ‹Ÿå åœæµç¨‹</button>
            <button class="debug-button" onclick="testDataConsistency()">æµ‹è¯•æ•°æ®ä¸€è‡´æ€§</button>
            <button class="debug-button" onclick="clearDebugData()">æ¸…é™¤è°ƒè¯•æ•°æ®</button>
        </div>

        <div class="debug-section">
            <h2 class="debug-title">æ•°æ®å¯¹æ¯”</h2>
            <div id="dataComparison" class="data-display" style="display: none;">
                <div class="data-title">ä¸‰å¦æ•°æ®å¯¹æ¯”</div>
                <div class="hexagram-comparison">
                    <div class="hexagram-item">
                        <div class="hexagram-name">åç«¯APIæ•°æ®</div>
                        <div id="apiPrimary" class="hexagram-lines"></div>
                        <div id="apiMutual" class="hexagram-lines"></div>
                        <div id="apiChange" class="hexagram-lines"></div>
                        <div id="apiMovingLine" style="color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;"></div>
                    </div>
                    <div class="hexagram-item">
                        <div class="hexagram-name">åŠ¨ç”»ç»„ä»¶æ•°æ®</div>
                        <div id="animationPrimary" class="hexagram-lines"></div>
                        <div id="animationMutual" class="hexagram-lines"></div>
                        <div id="animationChange" class="hexagram-lines"></div>
                        <div id="animationMovingLine" style="color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;"></div>
                    </div>
                    <div class="hexagram-item">
                        <div class="hexagram-name">ç»“æœé¡µé¢æ•°æ®</div>
                        <div id="resultPrimary" class="hexagram-lines"></div>
                        <div id="resultMutual" class="hexagram-lines"></div>
                        <div id="resultChange" class="hexagram-lines"></div>
                        <div id="resultMovingLine" style="color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;"></div>
                    </div>
                </div>
                <div id="consistencyStatus" class="status warning"></div>
            </div>
        </div>

        <div class="debug-section">
            <h2 class="debug-title">è°ƒè¯•æ—¥å¿—</h2>
            <div id="debugLog" class="log-section">
                <div class="log-entry log-info">ç­‰å¾…è°ƒè¯•æ•°æ®...</div>
            </div>
        </div>
    </div>

    <script>
        let debugData = {
            apiData: null,
            animationData: null,
            resultData: null
        };

        function log(message, type = 'info') {
            const logSection = document.getElementById('debugLog');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logSection.appendChild(logEntry);
            logSection.scrollTop = logSection.scrollHeight;
        }

        function simulateDivination() {
            log('å¼€å§‹æ¨¡æ‹Ÿå åœæµç¨‹...', 'info');
            
            // æ¨¡æ‹Ÿåç«¯APIè¿”å›çš„æ•°æ®
            const apiResult = {
                hexagrams: {
                    ben: {
                        lines: [0, 1, 0, 1, 1, 0], // æ¨¡æ‹ŸçœŸå®å åœç»“æœ
                        name: "æ°´å¤©éœ€"
                    },
                    hu: {
                        lines: [1, 0, 1, 0, 1, 0],
                        name: "ç«å¤©å¤§æœ‰"
                    },
                    bian: {
                        lines: [0, 1, 0, 0, 1, 0], // ç¬¬4çˆ»å˜åŒ–
                        name: "æ°´åœ°æ¯”"
                    }
                },
                movingLine: 4
            };
            
            debugData.apiData = apiResult;
            log('âœ… åç«¯APIæ•°æ®ç”Ÿæˆå®Œæˆ', 'success');
            
            // æ¨¡æ‹ŸåŠ¨ç”»ç»„ä»¶å¤„ç†
            const animationResult = {
                primaryHexagram: apiResult.hexagrams.ben.lines,
                mutualHexagram: apiResult.hexagrams.hu.lines,
                changeHexagram: apiResult.hexagrams.bian.lines,
                movingLine: apiResult.movingLine
            };
            
            debugData.animationData = animationResult;
            log('âœ… åŠ¨ç”»ç»„ä»¶æ•°æ®å¤„ç†å®Œæˆ', 'success');
            
            // æ¨¡æ‹Ÿç»“æœé¡µé¢æ•°æ®
            debugData.resultData = apiResult;
            log('âœ… ç»“æœé¡µé¢æ•°æ®è®¾ç½®å®Œæˆ', 'success');
            
            displayDataComparison();
            testDataConsistency();
        }

        function displayDataComparison() {
            if (!debugData.apiData) return;
            
            // æ˜¾ç¤ºAPIæ•°æ®
            document.getElementById('apiPrimary').innerHTML = formatHexagram(debugData.apiData.hexagrams.ben.lines, 'ä¸»å¦');
            document.getElementById('apiMutual').innerHTML = formatHexagram(debugData.apiData.hexagrams.hu.lines, 'äº’å¦');
            document.getElementById('apiChange').innerHTML = formatHexagram(debugData.apiData.hexagrams.bian.lines, 'å˜å¦', debugData.apiData.movingLine);
            document.getElementById('apiMovingLine').textContent = `åŠ¨çˆ»ï¼šç¬¬${debugData.apiData.movingLine}çˆ»`;
            
            // æ˜¾ç¤ºåŠ¨ç”»æ•°æ®
            if (debugData.animationData) {
                document.getElementById('animationPrimary').innerHTML = formatHexagram(debugData.animationData.primaryHexagram, 'ä¸»å¦');
                document.getElementById('animationMutual').innerHTML = formatHexagram(debugData.animationData.mutualHexagram, 'äº’å¦');
                document.getElementById('animationChange').innerHTML = formatHexagram(debugData.animationData.changeHexagram, 'å˜å¦', debugData.animationData.movingLine);
                document.getElementById('animationMovingLine').textContent = `åŠ¨çˆ»ï¼šç¬¬${debugData.animationData.movingLine}çˆ»`;
            }
            
            // æ˜¾ç¤ºç»“æœé¡µé¢æ•°æ®
            document.getElementById('resultPrimary').innerHTML = formatHexagram(debugData.resultData.hexagrams.ben.lines, 'ä¸»å¦');
            document.getElementById('resultMutual').innerHTML = formatHexagram(debugData.resultData.hexagrams.hu.lines, 'äº’å¦');
            document.getElementById('resultChange').innerHTML = formatHexagram(debugData.resultData.hexagrams.bian.lines, 'å˜å¦', debugData.resultData.movingLine);
            document.getElementById('resultMovingLine').textContent = `åŠ¨çˆ»ï¼šç¬¬${debugData.resultData.movingLine}çˆ»`;
            
            document.getElementById('dataComparison').style.display = 'block';
        }

        function formatHexagram(lines, name, movingLine = null) {
            let result = `${name}: `;
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                const isMoving = movingLine && (i + 1) === movingLine;
                
                if (line === 1) {
                    result += `<span class="line-yang ${isMoving ? 'moving-line' : ''}">âšŠ</span>`;
                } else {
                    result += `<span class="line-yin ${isMoving ? 'moving-line' : ''}">âš‹</span>`;
                }
            }
            return result;
        }

        function testDataConsistency() {
            if (!debugData.apiData || !debugData.animationData || !debugData.resultData) {
                log('âŒ ç¼ºå°‘è°ƒè¯•æ•°æ®ï¼Œæ— æ³•è¿›è¡Œä¸€è‡´æ€§æµ‹è¯•', 'error');
                return;
            }
            
            log('å¼€å§‹æ•°æ®ä¸€è‡´æ€§æµ‹è¯•...', 'info');
            
            let isConsistent = true;
            let issues = [];
            
            // æµ‹è¯•ä¸»å¦ä¸€è‡´æ€§
            const apiPrimary = debugData.apiData.hexagrams.ben.lines;
            const animationPrimary = debugData.animationData.primaryHexagram;
            const resultPrimary = debugData.resultData.hexagrams.ben.lines;
            
            if (!arraysEqual(apiPrimary, animationPrimary)) {
                isConsistent = false;
                issues.push('ä¸»å¦ï¼šAPIä¸åŠ¨ç”»æ•°æ®ä¸ä¸€è‡´');
                log(`âŒ ä¸»å¦ä¸ä¸€è‡´ - API: [${apiPrimary}] vs åŠ¨ç”»: [${animationPrimary}]`, 'error');
            } else {
                log(`âœ… ä¸»å¦ä¸€è‡´ - [${apiPrimary}]`, 'success');
            }
            
            if (!arraysEqual(apiPrimary, resultPrimary)) {
                isConsistent = false;
                issues.push('ä¸»å¦ï¼šAPIä¸ç»“æœé¡µé¢æ•°æ®ä¸ä¸€è‡´');
                log(`âŒ ä¸»å¦ä¸ä¸€è‡´ - API: [${apiPrimary}] vs ç»“æœ: [${resultPrimary}]`, 'error');
            } else {
                log(`âœ… ä¸»å¦ä¸€è‡´ - [${apiPrimary}]`, 'success');
            }
            
            // æµ‹è¯•äº’å¦ä¸€è‡´æ€§
            const apiMutual = debugData.apiData.hexagrams.hu.lines;
            const animationMutual = debugData.animationData.mutualHexagram;
            const resultMutual = debugData.resultData.hexagrams.hu.lines;
            
            if (!arraysEqual(apiMutual, animationMutual)) {
                isConsistent = false;
                issues.push('äº’å¦ï¼šAPIä¸åŠ¨ç”»æ•°æ®ä¸ä¸€è‡´');
                log(`âŒ äº’å¦ä¸ä¸€è‡´ - API: [${apiMutual}] vs åŠ¨ç”»: [${animationMutual}]`, 'error');
            } else {
                log(`âœ… äº’å¦ä¸€è‡´ - [${apiMutual}]`, 'success');
            }
            
            // æµ‹è¯•å˜å¦ä¸€è‡´æ€§
            const apiChange = debugData.apiData.hexagrams.bian.lines;
            const animationChange = debugData.animationData.changeHexagram;
            const resultChange = debugData.resultData.hexagrams.bian.lines;
            
            if (!arraysEqual(apiChange, animationChange)) {
                isConsistent = false;
                issues.push('å˜å¦ï¼šAPIä¸åŠ¨ç”»æ•°æ®ä¸ä¸€è‡´');
                log(`âŒ å˜å¦ä¸ä¸€è‡´ - API: [${apiChange}] vs åŠ¨ç”»: [${animationChange}]`, 'error');
            } else {
                log(`âœ… å˜å¦ä¸€è‡´ - [${apiChange}]`, 'success');
            }
            
            // æµ‹è¯•åŠ¨çˆ»ä¸€è‡´æ€§
            const apiMovingLine = debugData.apiData.movingLine;
            const animationMovingLine = debugData.animationData.movingLine;
            const resultMovingLine = debugData.resultData.movingLine;
            
            if (apiMovingLine !== animationMovingLine) {
                isConsistent = false;
                issues.push('åŠ¨çˆ»ï¼šAPIä¸åŠ¨ç”»æ•°æ®ä¸ä¸€è‡´');
                log(`âŒ åŠ¨çˆ»ä¸ä¸€è‡´ - API: ${apiMovingLine} vs åŠ¨ç”»: ${animationMovingLine}`, 'error');
            } else {
                log(`âœ… åŠ¨çˆ»ä¸€è‡´ - ${apiMovingLine}`, 'success');
            }
            
            // æ˜¾ç¤ºæœ€ç»ˆçŠ¶æ€
            const statusDiv = document.getElementById('consistencyStatus');
            if (isConsistent) {
                statusDiv.textContent = 'âœ… æ‰€æœ‰æ•°æ®å®Œå…¨ä¸€è‡´ï¼';
                statusDiv.className = 'status success';
                log('ğŸ‰ æ•°æ®ä¸€è‡´æ€§æµ‹è¯•é€šè¿‡ï¼', 'success');
            } else {
                statusDiv.textContent = `âŒ å‘ç° ${issues.length} ä¸ªä¸ä¸€è‡´é—®é¢˜`;
                statusDiv.className = 'status error';
                log(`âŒ æ•°æ®ä¸€è‡´æ€§æµ‹è¯•å¤±è´¥ï¼Œå‘ç° ${issues.length} ä¸ªé—®é¢˜`, 'error');
                issues.forEach(issue => log(`  - ${issue}`, 'error'));
            }
        }

        function arraysEqual(a, b) {
            if (a.length !== b.length) return false;
            for (let i = 0; i < a.length; i++) {
                if (a[i] !== b[i]) return false;
            }
            return true;
        }

        function clearDebugData() {
            debugData = {
                apiData: null,
                animationData: null,
                resultData: null
            };
            
            document.getElementById('dataComparison').style.display = 'none';
            document.getElementById('debugLog').innerHTML = '<div class="log-entry log-info">è°ƒè¯•æ•°æ®å·²æ¸…é™¤</div>';
            
            log('è°ƒè¯•æ•°æ®å·²æ¸…é™¤', 'info');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œä¸€æ¬¡æµ‹è¯•
        window.addEventListener('load', function() {
            log('å åœæ•°æ®ä¸€è‡´æ€§è°ƒè¯•å·¥å…·å·²åŠ è½½', 'info');
            log('ç‚¹å‡»"æ¨¡æ‹Ÿå åœæµç¨‹"å¼€å§‹æµ‹è¯•', 'info');
        });
    </script>
</body>
</html>
